pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()

map_layout()
plr_init()
inventory_init()

end

function _update()
plr_update()
end



function _draw()
	cls()
	draw_cam(plr)
	draw_map(tiles)
	plr_draw(plr)
	inventory_draw()
	print(plr.x)
	print(plr.y)
	
	print(map_data[flr(plr.x / 16) + 1][flr(plr.y / 8) + 1])


end
-->8
-- map gen --

function map_tiles()
	
	tiles ={
	grass = 8,
	water = 4,
	half = 12,
	tree = 128,
	soil = 132 
	}
		
end


function map_layout()

	map_tiles()
	
	map_data = {
  {8,128,128,8,8,8,8,8},
  {8,128,128,8,8,8,8,8},
  {8,128,128,8,8,8,8,8},
  {8,128,128,8,8,8,8,8},
  {8,8,8,8,8,8,8,8},
  {8,4,4,4,8,8,8,8},
  {8,4,4,8,8,8,8,8},
  {8,8,8,8,8,8,8,8},
  {8,128,128,8,8,8,8,8},
  {8,8,8,8,8,8,8,8}
}

end


function iso_coords(x, y)

  local sx = (x - y) * 16 + 64  -- 16 = half width of 32px tile
  local sy = (x + y) * 8        -- 8 = half height of 16px tile
  return sx, sy
  
end

function draw_map(tiles)

 -- gets the height(y) and width(x)
	for y=1,#map_data do
	
    for x=1,#map_data[y] do
    
    		-- what tile is it
      local tile = map_data[y][x]
      
      if tile != 0 then
      
      		-- calc the location to go
        local sx, sy = iso_coords(x, y)
        
       
  					 --local spr_id = 8
  					 
       	if tile == 8 then
       		spr_id = tiles.grass
       	end
       	
       	if tile == 4 then
       		spr_id = tiles.water
       	end
       	
       	if tile == 12 then
       		spr_id = tiles.half
       	end
       	
       	if tile == 128 then
       		spr_id = tiles.tree
       		sy-=16 -- adjust 
       	end
       	
       	if tile == 132 then
       		spr_id = tiles.soil
       	end
       	
        
        spr(spr_id, sx, sy, 4, 4)
      end
      
    end
    
  end
  
end


-->8
-- player --

function plr_init()
	plr ={
	sprite = 64,
	first_sprite = 64,
	last_sprite = 68,
	height = 2,
	width = 2,
	x = 32,
	y = 32,
	speed = 1,
	animation_timer = 0,
	fx = false,
	fy = false
	}
end

function plr_update()
	plr_move(plr)
	plr_actions()
end

function plr_move(plr)
	
	if btn(⬆️) then
		plr.y-=plr.speed
		animation(plr)
	end
	
	if btn(⬇️) then
		plr.y+=plr.speed
		animation(plr)
	end
	
	if btn(⬅️) then
		plr.x-=plr.speed
		plr.fx = true
		animation(plr)
	end
	
	if btn(➡️) then
		plr.x+=plr.speed
		plr.fx = false
			animation(plr)
	end
	
	
		
end

function plr_actions()
	
	if btnp(❎) then
  local tx, ty = get_tile_pos(plr.x, plr.y)
  local tile = map_data[ty][tx]

  if tile == 8 then
    tile_action(plr, tiles, tiles.soil, 8)
    
	  elseif tile == 132 then
	  
	    tile_action(plr, tiles, tiles.grass, 132)
	  
	  elseif tile == 128 then
	    tile_action(plr, tiles, tiles.grass, 128)
 
  end -- tiles
  
	end -- if (❎)
	
end




function plr_draw(plr)
	spr(plr.sprite,plr.x,plr.y,plr.height,plr.width,plr.fx,plr.fy)
--	spr(74,flr(plr.x),flr(plr.y),2,2,plr.fx,plr.fy)
--	spr(76,flr(plr.x),flr(plr.y),2,2,plr.fx,plr.fy)

end

function animation(plr)
	
		plr.animation_timer +=1
		
		if plr.animation_timer % 2 == 0 then		
			plr.sprite+=2
		end
			
		if plr.animation_timer >= 6
			then
			plr.sprite = plr.first_sprite
			plr.animation_timer = 0
		end
		
end


-->8
-- camera --

function draw_cam(plr)
	cx=plr.x+8-63
	cy=plr.y+8-63
	camera(cx,cy)
end
-->8

-- reverse isometric projection
-- calculates the actual position
function get_tile_pos(px, py)
  local x = flr(((px - 74) / 16 + py / 8) / 2) + 1
  local y = flr((py / 8 - (px - 64) / 16) / 2) + 1
  return x, y
end


function tile_action(plr,tiles,tile,to_change)

  local tx, ty = get_tile_pos(plr.x, plr.y)

		-- can change tile only if is over certain tile
  if map_data and map_data[ty][tx] and  map_data[ty][tx] == to_change then
    -- change tile 
    map_data[ty][tx] = tile
  end
  
end

-->8
-- inventory --

function inventory_init()
	
	inv={}
	
	add(inv,{
	
	name = 'axe',
	amount = 1,
	sprite = 74
	})
	
	
	add(inv,{
	
	name = 'gold',
	amount = 5,
	sprite = 75
	})
	
end

function inventory_draw()
	
	rectfill(30,116,98,125,15)
	
	for i=1,#inv do
		spr(inv[i].sprite,22+9*i,117,1,1)
	end
	
end

__gfx__
00000000000000011000000000000000000000000000000110000000000000000000000000000001100000000000000000000000000000011000000000000000
00000000000001155110000000000000000000000000011cc110000000000000000000000000011bb110000000000000000000000000011bb110000000000000
000000000001155555511000000000000000000000011cccccc11000000000000000000000011bbbbbb11000000000000000000000011bbbbbb1100000000000
0000000001155555555551100000000000000000011cccccccccc1100000000000000000011bbbbbbbbbb1100000000000000000011bbbbbbbbbb11000000000
00000001155555555555555110000000000000011cccccccccccccc110000000000000011bbbbbbbbbbbbbb110000000000000011bbbbbbbbbbbbbb110000000
000001155555555555555555511000000000011cccccccccccccccccc11000000000011bbbbbbbbbbbbbbbbbb11000000000011bbbbbbbbbbbbbbbbbb1100000
0001155555555555555555555551100000011cccccccccccccccccccccc1100000011bbbbbbbbbbbbbbbbbbbbbb1100000011bbbbbbbbbbbbbbbbbbbbbb11000
00155555555555555555555555555100001cccccccccccccccccccccccccc100001bbbbbbbbbbbbbbbbbbbbbbbbbb100001bbbbbbbbbbbbbbbbbbbbbbbbbb100
0155555555555555555555555555551001cccccccccccccccccccccccccccc10013bbbbbbbbbbbbbbbbbbbbbbbbbb310013bbbbbbbbbbbbbbbbbbbbbbbbbb310
0155555555555555555555555555551001cccccccccccccccccccccccccccc1001333bbbbbbbbbbbbbbbbbbbbbb3331001333bbbbbbbbbbbbbbbbbbbbbb33310
0155555555555555555555555555551001cccccccccccccccccccccccccccc100133333bbbbbbbbbbbbbbbbbb33333100133333bbbbbbbbbbbbbbbbbb3333310
014455555555555555555555555544100111cccccccccccccccccccccccc1110014433333bbbbbbbbbbbbbb333334410014433333bbbbbbbbbbbbbb333334410
01444455555555555555555555444410011111cccccccccccccccccccc11111001444433333bbbbbbbbbb3333344441001444433333bbbbbbbbbb33333444410
0144444455555555555555554444441001111111cccccccccccccccc111111100144444433333bbbbbb33333444444100144444433333bbbbbb3333344444410
014444444455555555555544444444100111111111cccccccccccc1111111110014444444433333bb333334444444410014444444433333bb333334444444410
01444544444455555555444444444410011111111111cccccccc1111111111100144454444443333333344444444441001444544444433333333444444444410
0144545444444455544444445544441001111111111111ccc1111111111111100144545444444433344444445544441001445454444444333444444455444410
01444445444444444444444454444410001111111111111111111111111111000144444544444444444444445444441001444445444444444444444454444410
01455444444444444444454544444410000111111111111111111111111110000145544444444444444445454444441001455444444444444444454544444410
01445444444444444444444444444410000001111111111111111111111000000144544444444444444444444444441001445444444444444444444444444410
01444544444444444444444444444410000000011111111111111111100000000144454444444444444444444444441001444544444444444444444444444410
01444444444444444444444444444410000000000111111111111110000000000144444444444444444444444444441001444444444444444444444444444410
01444444444444544544444444444410000000000001111111111000000000000144444444444454454444444444441001444444444444544544444444444410
00144444444444454444444444444100000000000000011111100000000000000014444444444445444444444444410000144444444444454444444444444100
00011444444445544444444444411000000000000000000110000000000000000001144444444554444444444441100000011444444445544444444444411000
00000114444444444444444441100000000000000000000000000000000000000000011444444444444444444110000000000114444444444444444441100000
00000001144444444444444110000000000000000000000000000000000000000000000114444444444444411000000000000001144444444444444110000000
00000000011444444444411000000000000000000000000000000000000000000000000001144444444441100000000000000000011444444444411000000000
00000000000114444441100000000000000000000000000000000000000000000000000000011444444110000000000000000000000114444441100000000000
00000000000001144110000000000000000000000000000000000000000000000000000000000114411000000000000000000000000001144110000000000000
00000000000000011000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000011000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011111100000000001111110000000000111111000000000000000000000000000000000000000011100011110000000000000000000000000000000000
00000177777710000000017777771000000001777777100000000000000000000000000000000000000145810199991000000000000000000000000000000000
00001777777771000000177777777100000017777777710000000000000000000000000000000000001448811999999100000000000000000000000000000000
00001777c77c710000001777c77c710000001777c77c710000000000000000000000000000000000014176611999999100000000000000000000000000000000
00001777c77c710000001777c77c710000001777c77c710000000000000000000000000000000000141011101999999100000000000000000000000000000000
00001677777761000000167777776100000016777777610000000000000000000000000000000000010000001999999100000000000000000000000000000000
00000166666610000000016666661000000001666666100000000000000000000000000000000000000000000199991000000000000000000000000000000000
00000011111100000000001111110000000000111111000000000000000000000000000000000000000000000011110000000000000000000000000000000000
00000017777100000000001777710000000000177771000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000017777100000000001777710000000000177771000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000017777100000000001777710000000000177771000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000017716100000000001771610000000000177161000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000017716100000000001111610000000000177111000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011111100000000000001110000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000177777710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001777777771000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001777c77c71000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001777c77c71000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001677777761000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000166666610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000111000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000001bbb110000000000000000000000000011441100000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000131bbbb1000000000000000000000001144444411000000000000000000000000000000000000000000000000000000000000000000000000000
000000000011333111bb100000000000000000000114444444444110000000000000000000000000000000000000000000000000000000000000000000000000
00000000013333333311100000000000000000011444444444444441100000000000000000000000000000000000000000000000000000000000000000000000
00000000013331333333100000000000000001144444444444444444411000000000000000000000000000000000000000000000000000000000000000000000
0000000001bb3b131b33b10000000000000114444444444444444444444110000000000000000000000000000000000000000000000000000000000000000000
00000000131bbb131b3b131000000000001444444444444444444444444441000000000000000000000000000000000000000000000000000000000000000000
000000001331b13331bb131000000000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
00000000133313333311333100000000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
00000001333333333333333100000000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
000000133333b1bbb1b333b100000000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
00000011b33b131b131b3b1100000000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
000000131bb13331b1b1b13310000000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
000001b33113331bb13b1b3b10000000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
0000011bbbb13331133331b131000000014445444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
000001311b1333333333311131000000014454544444444444444444554444100000000000000000000000000000000000000000000000000000000000000000
0000001bb1b331222213333331000000014444454444444444444444544444100000000000000000000000000000000000000000000000000000000000000000
0000000111111b4444b1111110000000014554444444444444444545444444100000000000000000000000000000000000000000000000000000000000000000
00000000011bbb4454bbb11000000000014454444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
000000011bbbbb4454bbbbb110000000014445444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
0000011bbbbbb444454bbbbbb1100000014444444444444444444444444444100000000000000000000000000000000000000000000000000000000000000000
00011bbbbbbb44454444bbbbbbb11000014444444444445445444444444444100000000000000000000000000000000000000000000000000000000000000000
001bbbbbbbb4445544444bbbbbbbb100001444444444444544444444444441000000000000000000000000000000000000000000000000000000000000000000
013bbbbbbb444444445444bbbbbbb310000114444444455444444444444110000000000000000000000000000000000000000000000000000000000000000000
01333bbbbbb4444445444bbbbbb33310000001144444444444444444411000000000000000000000000000000000000000000000000000000000000000000000
0133333bbbbbb444444bbbbbb3333310000000011444444444444441100000000000000000000000000000000000000000000000000000000000000000000000
014433333bbbbbb44bbbbbb333334410000000000114444444444110000000000000000000000000000000000000000000000000000000000000000000000000
01444433333bbbbbbbbbb33333444410000000000001144444411000000000000000000000000000000000000000000000000000000000000000000000000000
0144444433333bbbbbb3333344444410000000000000011441100000000000000000000000000000000000000000000000000000000000000000000000000000
014444444433333bb333334444444410000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000
01444544444433333333444444444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01445454444444333444444455444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00144445444444444444444454444100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011444444444444444454544411000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000114444444444444444441100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000001144444444444444110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011444444444411000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000114544541100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000001154110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80808080808080800c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
808080808080801c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
808080808080801c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c000000001c1c1c1c1c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
