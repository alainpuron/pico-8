pico-8 cartridge // http://www.pico-8.com
version 43
__lua__

function _init()
map_layout()
plr_init()

generate()

end

function _update()
plr_update()

end

function _draw()
cls()

draw_cam(plr)
draw_map(tiles)
plr_draw(plr)

end
-->8
-- map setup --
function map_tiles()

	tiles ={
	
	grass   = 0,
	dirt    =	2,
	seed    = 4,
	watered = 6,
	crop    = 8,
	tree    = 12,
	water   = 32, 

	}
	
end

function map_layout()
	map_tiles()
	
	map_data = {
  {0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0},
  {0,0,32,32,0,0,0,0},
  {0,0,32,32,0,0,0,0},
  {0,0,0,0,0,0,0,0},
  {0,0,0,0,0,0,0,0},

}


	overlay_data = {}
    for y=1,#map_data do
        overlay_data[y] = {}
        for x=1,#map_data[y] do
            overlay_data[y][x] = nil -- no overlay by default
        end
    end


end

-- calc where how isometrics works
function iso_coords(x, y)

  local sx = (x - y) * 8 + 16 
  local sy = (x + y) * 4 
  return sx, sy
  
end

function draw_map(tiles)
    for y=1,#map_data do
        for x=1,#map_data[y] do
            local base_tile = map_data[y][x]
            local sx, sy = iso_coords(x, y)

            -- draw base tile
            spr(base_tile, sx, sy, 2, 2)

            -- draw overlay if exists
            local overlay_tile = overlay_data[y][x]
            if overlay_tile then
                spr(overlay_tile, sx+8, sy - 14, 2, 2)
            end
        end
    end
end


-- reverse isometric projection
-- calculates the actual position

function get_tile_pos(px, py)
  local x = flr(((px - 26) / 8 + py / 4) / 2) + 1
  local y = flr((py / 4 - (px - 16) / 8) / 2) + 1
  return x, y
end

-->8
-- player  -- 

function plr_init()
	plr =	{
	
	sprite = 130,
	first_sprite = 128,
	last_sprite = 128,
	height = 1,
	width = 1,
	x = 50,
	y = 50,
	speed = 1,
	animation_timer = 0,
	fx = false,
	fy = false
	
	}
end

function plr_draw(plr)
	player_looking(plr)

	spr(plr.sprite,plr.x,plr.y,plr.height,plr.width,plr.fx,plr.fy)

end

function plr_update()
	plr_move(plr)
	
--	plr_actions()
end

function plr_move(plr)

	local dx = 0
	local dy = 0

	if btn(⬆️) then dy -= plr.speed  end
	if btn(⬇️) then dy += plr.speed  end
	if btn(⬅️) then dx -= plr.speed plr.fx = true  end
	if btn(➡️) then dx += plr.speed plr.fx = false  end

	local new_x = plr.x + dx
	local new_y = plr.y + dy

	if not  has_flag then
		plr.x = new_x 
		plr.y = new_y 
	end
	
end
-->8
-- camera --

function draw_cam(plr)
	cx=plr.x+8-63
	cy=plr.y+8-63
	camera(cx,cy)
end

-- marks where the player is standing 
function player_looking(plr)
  local tx, ty =  get_tile_pos(plr.x, plr.y)

  if map_data and map_data[ty] and map_data[ty][tx] then
    local px, py = iso_coords(tx, ty)

    -- draw sprite 0 at the correct pixel position
    spr(10, px, py, 2, 2)
  end
end

-->8

function generate()
    for y=2,#map_data do
        for x=2,#map_data[y] do
            if map_data[y][x] == tiles.grass and flr(rnd(10)) < 2 then
                overlay_data[y][x] = tiles.tree
            end
        end
    end
end

__gfx__
00000001100000000000000110000000000000011000000000000001100000000000000110000000000000077000000000000011110000000000000000000000
0000011bb11000000000011441100000000001144110000000000114d11000000000011441100000000007700770000000001133bb1100000000000000000000
00111bbbbbb11100001114444441110000111444244111000011144d2d4111000011144444411100007770000007770000113333333311000000000000000000
01bbbbbbbbbbbb1001444444444444100144444444442410014d4444d44d2d100144444443444410070000000000007001b33331313333100000000000000000
1bbbbbbbbbbbbbb11444444444444441144244444444444114d2d44d4444d441144444443344444170000000000000071b33331b1b1333310000000000000000
133bbbbbbbbbb33114444444444444411444444244444441144d44d2d4d444411444444994444441077000000000077013313131b13131310000000000000000
14433bbbbbb33441144444444444444114444444442444411444444d4d2d444114444659966444410007700000077000131b1b13131b1b110000000000000000
1444433bb3344541144444444444454114444444444445411444444444d44541144444669544454100000770077000001b31b1333331b1310000000000000000
14444443344444411444444444444441144444444444444114444444444444411444444664444441000000077000000001b31333333313100000000000000000
14444444444454411444444444445441144444444444544114444444444454411444444444445441000000000000000000113bb3333311000000000000000000
14444454444444411444445444444441144444544444444114444454444444411444445444444441000000000000000000001122221100000000000000000000
144544454444444114454445444444411445444544444441144544454444444114454445444444410000000000000000000001dddd1000000000000000000000
01444444444444100144444444444410014444444444441001444444444444100144444444444410000000000000000000000144451000000000000000000000
00111444444111000011144444411100001114444441110000111444444111000011144444411100000000000000000000001445544100000000000000000000
00000114411000000000011441100000000001144110000000000114411000000000011441100000000000000000000000014554444410000000000000000000
00000001100000000000000110000000000000011000000000000001100000000000000110000000000000000000000000001111111100000000000000000000
00000001100000000000000110000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000011cc11000000000011cc11000000000011cc110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111cccccc1110000111cc7ccc1110000111cccccc1110000000000000000000000000000000000000000000000000000000000000000000000000000000000
01cccccccccccc1001cccc7ccccccc1001cccccc7c7ccc1000000000000000000000000000000000000000000000000000000000000000000000000000000000
1cccccccccccccc11ccc77ccc77cccc11cccccc7ccccccc100000000000000000000000000000000000000000000000000000000000000000000000000000000
777cccccccccc777777ccccc7cccc777777ccc7cc77cc77700000000000000000000000000000000000000000000000000000000000000000000000000000000
71177cccccc7711771177cccccc7711771177ccc7cc7711700000000000000000000000000000000000000000000000000000000000000000000000000000000
7111177cc77111177111177cc77111177111177cc771111700000000000000000000000000000000000000000000000000000000000000000000000000000000
71111117711111177111111771111117711111177111111700000000000000000000000000000000000000000000000000000000000000000000000000000000
71771111111177177177111111117717717711111111771700000000000000000000000000000000000000000000000000000000000000000000000000000000
71117711111171177111771111117117711177111111711700000000000000000000000000000000000000000000000000000000000000000000000000000000
71111111177111177111111117711117711111111771111700000000000000000000000000000000000000000000000000000000000000000000000000000000
07111117711111700711111771111170071111177111117000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777111111777000077711111177700007771111117770000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000771177000000000077117700000000007711770000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000007700000000000000770000000000000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06515150000000000000000000000000000000000000000000000000000000000000011100000000000000000000000000000000000000000000000000000000
16677371000000000000000000000000000000000000000000000000000000000000144100000000000000000000000000000000000000000000000000000000
167aa331000000000000000000000000000000000000000000000000000000000001444100000000000000000000000000000000000000000000000000000000
17a99a71000000000000000000000000000000000000000000000000000000000014441000000000000000000000000000000000000000000000000000000000
1a999a71000000000000000000000000000000000000000000000000000000000144410000000000000000000000000000000000000000000000000000000000
1a99a761000000000000000000000000000000000000000000000000000000001f44100000000000000000000000000000000000000000000000000000000000
1aaa7661000000000000000000000000000000000000000000000000000000001ff1000000000000000000000000000000000000000000000000000000000000
01111110000000000000000000000000000000000000000000000000000000001110000000000000000000000000000000000000000000000000000000000000
00001110000000000000000000000000000000000000000000000000000000000004b30000000000000000000000000000000000000000000000000000000000
0001458100000000000000000000000000000000000000000000000000000000003430b000000000000000000000000000000000000000000000000000000000
00144881000000000000000000000000000000000000000000000000000000000303430000000000000000000000000000000000000000000000000000000000
01417661000000000000000000000000000000000000000000000000000000000033433000000000000000000000000000000000000000000000000000000000
14101110000000000000000000000000000000000000000000000000000000000304500300000000000000000000000000000000000000000000000000000000
010000000000000000000000000000000000000000000000000000000000000000345b0000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000033b33b000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000
01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
14100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00141110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00014661000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00016661000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00016661000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
14100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
14411110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01444651000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00116651000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00016651000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00015551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111111111111000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
017777777777771007aaaa7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
177777777777777179acfc7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17777777777777717a9fff7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17777777c77c777107fee1f700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17777777c77c7771007e117000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16777777777777610074747000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01666666666666100007070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001777777100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001777777100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001777777100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001777177100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001771177100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001771177100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
