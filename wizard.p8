pico-8 cartridge // http://www.pico-8.com
version 43
__lua__

function _init()
	map_setup()
	plr_init() -- plr def values
end

function _update()
	plr_update() -- update player
end

function _draw()
	cls()
	map()
	
		plr_draw(plr)
		print(has_flag)
end
-->8
function plr_init()
    plr = {
        x = 0,
        y = 0,
        fx = false,
        fy = false,
        w = 16,
        h = 16,
        sprite_timer = 0,
        speed = 1,
        sp = 32, -- default sprite
        l_sprite = 34,
        moving = 36 -- moving sprite
    }
end


function plr_update()
    plr_move(plr)
    plr_animation(plr)
    
end

function plr_move(plr)
				
				local last_x = plr.x -- last x
    local last_y = plr.y -- last y
    

    if btn(⬆️) then plr.y -= plr.speed end
    if btn(⬇️) then plr.y += plr.speed end
    if btn(➡️) then plr.x += plr.speed end
    if btn(⬅️) then plr.x -= plr.speed end
    
    
    -- when blocked return to last position
				last_position(plr,last_x,last_y)
				
end


function plr_animation(plr)
				
    local animation_speed = 15

    if plr.sprite_timer < animation_speed then
        plr.sprite_timer += 1
    else
        if plr.sp < plr.l_sprite then
            plr.sp += 2
        else
            plr.sp = 32
        end
        plr.sprite_timer = 0
    end
    
end


function plr_draw(plr)
				
				
				if btn(➡️) then 
					plr.sp = plr.moving
					plr.fx = false
				end
				
				if btn(⬅️) then 
					plr.sp = plr.moving
					plr.fx = true
				end
				
				print(fget(plr.sp,blue))
    spr(plr.sp, plr.x, plr.y,2, 2,plr.fx,plr.fy)
end

-->8
-- collition --

function map_setup()

	-- the object and the flag
	purple = 0 
	blue = 1
	green = 2
	
end


function last_position(plr,last_x,last_y)
	
    local left = plr.x
    local right = plr.x + plr.w - 1
    local bottom = plr.y + plr.h - 1
    local top = plr.y
    
    
    
    local tile_type = {purple,green}

     -- if the player is trying
     -- to move into a wall tile, 
     -- cancel the movement by
     -- restoring the previous position
				for i = 0, #tile_type do
				
   	 if not can_move(tile_type[i],left, right, top, bottom) then
        plr.x = last_x 
        plr.y = last_y
    	end
    	
    end
    
end


-- checks if the player can move
-- to the given position by 
-- testing the four corners 
-- of the hitbox.

function can_move(tile_type, left, right, top, bottom)
    
    -- if any corner of the player's
    -- hitbox overlaps a tile with
    -- the given flag, return false

    return not (
    
        is_tile(tile_type, left, bottom) or
        is_tile(tile_type, right, bottom) or
        is_tile(tile_type, left, top) or
        is_tile(tile_type, right, top)
    )
    
end


-- what kind of tile is 
function is_tile(tile_type, x, y)

    local tile = mget(flr(x / 8), flr(y / 8))
    return fget(tile, tile_type)
    
end

__gfx__
000000008888888800000000020220200d0dd0d00303303000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000877887780000000020222202d0dddd0d3033330300000000000000000000000000000000000000000000000000000000000000000000000000000000
007007008788878800000000022222200dddddd00333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000888888880000000022222222dddddddd3333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000878888780000000022222222dddddddd3333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
007007008877778800000000022222200dddddd00333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888880000000020222202d0dddd0d3033330300000000000000000000000000000000000000000000000000000000000000000000000000000000
000000008888888800000000020220200d0dd0d00303303000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000ddddd000000000000000000000000000ddddd00000000000ddddd00000000000000000000000000000000000000000000000000000000000000000000000
00ddddddddd000000000ddddd000000000ddddddddd0000000ddddddddd000000000000000000000000000000000000000000000000000000000000000000000
00000ddddddd000000ddddddddd0000000000ddddddd00d000000ddddddd00d00000000000000000000000000000000000000000000000000000000000000000
0000dd000000d00000000ddddddd00000000dd000000dd000000dd000000dd000000000000000000000000000000000000000000000000000000000000000000
0dddddddddddddd00000dd000000d0000ddddddddddd00000ddddddddddd00000000000000000000000000000000000000000000000000000000000000000000
00000000000000000dddddddddddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000d0dd0d00000000000000000000000000d0dd0d0000000000d0dd0d00000000000000000000000000000000000000000000000000000000000000000000
0000d0dd00dd0000000000d0dd0d00000000d0dd00dd00000000d0dd00dd00000000000000000000000000000000000000000000000000000000000000000000
00000dddddd000000000d0dd00dd000000000dddddd0000000000dddddd000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000dddd00d00000000000000000000000d0dddd00d0000000dddddd00d000000000000000000000000000000000000000000000000000000000000000000000
000dddd0000d00000000dddd00d000000d0dddd0000d00000dddddd0000d00000000000000000000000000000000000000000000000000000000000000000000
000dddd0000d0000000dddd0000d000000dddd00000d00000ddddd00000d00000000000000000000000000000000000000000000000000000000000000000000
000dddd0000d0000000dddd0000d00000d0dd00000d000000dddd00000d000000000000000000000000000000000000000000000000000000000000000000000
000dddd0000d0000000dddd0000d000000ddd0000000000000ddd000000000000000000000000000000000000000000000000000000000000000000000000000
00dd0dd0000dd00000dd0dd0000dd00000dd00000000000000dd0000000000000000000000000000000000000000000000000000000000000000000000000000
00002222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00002200000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02222222222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000020220200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00002022002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00002222002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022220000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022220000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022220000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00022220000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00220220000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000102040000000000000000000000000000000000000000000000000000020202020202020200000000000000000202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000400000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000300000400000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000300000400000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000300000400000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000300000400000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000400000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
