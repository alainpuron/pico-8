pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

-- game loop 

function _init()
	map_setup()
	make_player()
    
end

function _update()
		update_map()
  move_player()
end

function _draw()
	cls()
	draw_map()
	draw_player()
 
 if (btn(❎)) show_inventory()

end
-->8
-- map code 

function map_setup()

	-- timers
	timer=0
	anim_time=30 -- 30 = 1sec

 	
 	-- map tile flags
 	
 	wall=0 -- walls get flag 0
 	key=1
 	door=2
 	anim1=3
 	anim2=4
 	lose=6
 	win=7

end


function update_map()
	if(timer<0) then
		toggle_tiles()
		timer=anim_time
	end
	timer-=1
end

function draw_map()
		mapx=flr(p.x/16)*16 -- w of map
		mapy=flr(p.y/16)*16	-- h of map
		camera(mapx*8,mapy*8) -- cam view
 	map(0,0,0,0,128,64) -- size

end

-- flag and x & y of tile
function is_tile(tile_type,x,y)

	-- get the tile 
	tile=mget(x,y)
	
	-- gets the flag of the tile
	has_flag=fget(tile,tile_type)

	-- if tile has a flag then true
	return has_flag
	
end

function can_move(x,y)

	-- (not) is opposite 
	
	-- if tile flag is wall then 
	-- can't move 
	return not is_tile(wall,x,y)
	
	
end


function swap_tile(x,y)
	tile=mget(x,y)
	
	-- swaps the tile for the next
	mset(x,y,tile+1)
end

function unswap_tile(x,y)
	tile=mget(x,y)
	
	-- swaps the tile for the next
	mset(x,y,tile-1)
end

function get_key(x,y)

	-- adds 1 key to inventory
 p.keys+=1
 
 swap_tile(x,y)
	sfx(1)
end


function open_door(x,y)
p.keys-=1
swap_tile(x,y)
sfx(2)
end
-->8
-- player code 

function make_player()
 p={}
 p.x=3
 p.y=5 
 p.sprite=1
 p.keys=0
end

function draw_player()
	spr(p.sprite,p.x*8,p.y*8)
end

function move_player()

	 newx=p.x
	 newy=p.y
	 
	 if (btnp(⬅️)) newx-=1
	 if (btnp(➡️)) newx+=1
	 if (btnp(⬆️)) newy-=1
		if (btnp(⬇️)) newy+=1
		
		interact(newx,newy)
		
		if (can_move(newx,newy)) then
			-- stops player from leaving map
			p.x=mid(0,newx,127)
			p.y=mid(0,newy,63)
			
			-- sound effect when can't move
		else
			sfx(0)
			
		end
		
end

function interact(x,y)
	
	-- checks if tile is key
	if(is_tile(key,x,y)) then
	
		get_key(x,y)
	
	-- open door & check 4 key
	elseif (is_tile(door,x,y)) and p.keys > 0 then
			open_door(x,y)
	end
 
	
end


-->8
-- inventory code 
function show_inventory()

invx=mapx*8+40
invy=mapy*8+8

rectfill(invx,invy,invx+48,invy+24,0)
print("inventory",invx+7,invy+4,7)
print("keys "..p.keys,invx+12,invy+14,9)
end
-->8
-- animation code

function toggle_tiles()

	for x=mapx,mapx+15 do
		for y=mapy,mapy+15 do
		
		-- checks if the tile is animeated
			if (is_tile(anim1,x,y)) then
			swap_tile(x,y)
			
			-- checks for anim2 
			elseif(is_tile(anim2,x,y)) then
				unswap_tile(x,y)
			end
			
		end
	end
	
	
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000041114000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333300000000333333333333333300000000333333333333333300000000000000000000000000000000000000000000000000000000
33333333333333333311113300000000999333333333333300000000363333633033330300000000000000000000000000000000000000000000000000000000
3333333333333bb331666613000000009a9999993333333300000000060330600603306000000000000000000000000000000000000000000000000000000000
3333333333333b331666661300000000939aa9a93333333300000000303333033033330300000000000000000000000000000000000000000000000000000000
3333333333bb3b33126666610000000099933a3a3333333300000000333333333333333300000000000000000000000000000000000000000000000000000000
33333333333b33331266666100000000aaa333333333333300000000363333633033330300000000000000000000000000000000000000000000000000000000
33333333333b33333122661300000000333333333333333300000000060330600603306000000000000000000000000000000000000000000000000000000000
33333333333333330011113300000000333333333333333300000000303333033033330300000000000000000000000000000000000000000000000000000000
1111111111cc111111111111000000004a4444a44a4444a400000000111111111111111100000000000000000000000000000000000000000000000000000000
111111111111111111111111000000004a4444a44544445400000000111111111111111100000000000000000000000000000000000000000000000000000000
111111111111111111666611000000004a4444a411199111000000001cc111111111111100000000000000000000000000000000000000000000000000000000
111111111111111116666611000000004a4444a411111111000000001cc111111cc1111100000000000000000000000000000000000000000000000000000000
1111111111cc1cc1c266666c00000000aaa99aaa111111110000000011111cc1111111c100000000000000000000000000000000000000000000000000000000
1111111111111111c266666c0000000019199191151111510000000011111cc111111cc100000000000000000000000000000000000000000000000000000000
11111111111111111c2266c1000000004a4444a44a4444a400000000111111111111111100000000000000000000000000000000000000000000000000000000
111111111111111111cccc11000000004a4444a44a4444a400000000111111111111111100000000000000000000000000000000000000000000000000000000
66666666666666666656666500000000666666666666666600000000333333333333333300000000000000000000000000000000000000000000000000000000
66666666666665565555555500000000166666660666666600000000333333333333333300000000000000000000000000000000000000000000000000000000
6666666666556666656656660000000046666666066666660000000033333bb33333bb3300000000000000000000000000000000000000000000000000000000
6666666666566666555555550000000046666666066666660000000033333b3333333b3300000000000000000000000000000000000000000000000000000000
6666666666666566666665660000000046666666066666660000000033bb3b33333b3b3300000000000000000000000000000000000000000000000000000000
66666666666656665555555500000000a66666660666666600000000333b333333bb333300000000000000000000000000000000000000000000000000000000
66666666665666666666666600000000466666660666666600000000333b3333333b333300000000000000000000000000000000000000000000000000000000
66666666665666665655555500000000666666666666666600000000333333333333333300000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000100020000481000000000000000010101000301000810000000000000000000010005000008100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010202020101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101014111010111010101010202022101010111011101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010121010101210101010101010202022101010101010101010101110101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010371010101210202020101010101010121010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010103710101010101024101020202720101010111010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1012101010101037101010101020202010101010121210101010101210101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010181710101020272720201010101010121010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2010371017181820202020272020101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2220202020313020272220201037101010101010101010111010101110101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202722303020202010371010121010101010101210101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2020202020313010102410101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2010101010303010101010101010101010101010101010111010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2010101010313130101032323232101010101210101010101010121010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010103031303132303032101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101030303134303032101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010111010111010101032323232101010101111101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000400000c0500c050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300001075000720207202073000750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000100000455004550045500455005550045500355000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
